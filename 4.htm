<div id="container">
    <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-transform"/>
    <meta name="sogou_site_verification" content="xSIboraCiG"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta name="keywords" content="CentOs,maillx,定时任务,邮件"/>
    <meta name="description" content="一段代码，一个故事"/>
    <link rel="shortcut icon" href="favicon.png" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/img/favicon.png"/>
    <link rel="apple-touch-icon" href="apple-touch-icon.png" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/img/apple-touch-icon.png"/>
    <script src="main.js" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/js/main.js"></script>
    <link href="style.min.css" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/css/style.min.css" rel="stylesheet">
    <link href="prism.css" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/css/prism.css" rel="stylesheet">
    <title>#2017-09-17# CentOS自动发邮件 - petterObam</title>
    <script src="particles.min.js" tppabs="http://cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
</head>
<body  gtools_scp_screen_capture_injected="true">
<!--[if lt IE 8]>
<div class="browsehappy" role="dialog">
    当前网页 <strong>不支持</strong> 你正在使用的浏览器. 为了正常的访问, 请 <a href="javascript:if(confirm(%27http://browsehappy.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://browsehappy.com/%27" tppabs="http://browsehappy.com/" target="_blank">升级你的浏览器</a>。
</div>
<![endif]-->
<div class="left-col">
    <div class="overlay"></div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="index.htm" tppabs="http://www.oyjie.cn/" class="profilepic">
                <img src="logo.png.jpg" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/img/logo.png" class="js-avatar">
            </a>
            <hgroup>
                <h1 class="header-author"><a href="index.htm" tppabs="http://www.oyjie.cn/">petterObam</a></h1>
                <p class="subtitle">一段代码，一个故事</p>
            </hgroup>
            <nav class="header-menu">
                <ul>
                    <li><a href="index.htm" tppabs="http://www.oyjie.cn/">主页</a></li>
                </ul>
            </nav>
            <nav class="header-smart-menu">
                <a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
                <a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
                <a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
                <a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
            </nav>
            <nav class="header-nav">
                <div class="social">


                    <a class="social rss" target="blank" href="feed.htm" tppabs="http://www.oyjie.cn/feed">RSS</a>

                    <!---->
                    <a class="github" target="blank"
                       href="javascript:if(confirm(%27https://github.com/petterobam  \n\nThis file was not retrieved by Teleport Pro, because it is addressed using an unsupported protocol (e.g., gopher).  \n\nDo you want to open it from the server?%27))window.location=%27https://github.com/petterobam%27" tppabs="https://github.com/petterobam">Github</a>
                    

                </div>
            </nav>
        </header>
    </div>
</div>
<div class="tools-col">
    <ul class="btn-wrap">
        <li class="" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
        <li data-hook="tools-section-tag" class="chose"><span class="text"></span><i class="icon-price-tags"></i></li>
        <li data-hook="tools-section-friends" class=""><span class="text">友链</span><i class="icon-link"></i></li>
        <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    </ul>
    <div class="tools-wrap">
        <section class="tools-section tools-section-all">

        </section>
        <section class="tools-section tools-section-tag chose">
            <div class="widget tagcloud" id="js-tagcloud">
                <a href="PDF.htm" tppabs="http://www.oyjie.cn/tag/PDF" style="font-size: 12px;" class="color3">PDF</a>
                <a href="CentOs.htm" tppabs="http://www.oyjie.cn/tag/CentOs" style="font-size: 12px;" class="color3">CentOs</a>
                <a href="sqlite.htm" tppabs="http://www.oyjie.cn/tag/sqlite" style="font-size: 12px;" class="color3">sqlite</a>
                <a href="面向对象.htm" tppabs="http://www.oyjie.cn/tag/面向对象" style="font-size: 12px;" class="color3">面向对象</a>
                <a href="封装.htm" tppabs="http://www.oyjie.cn/tag/封装" style="font-size: 12px;" class="color3">封装</a>
                <a href="数据库.htm" tppabs="http://www.oyjie.cn/tag/数据库" style="font-size: 12px;" class="color3">数据库</a>
                <a href="打包.htm" tppabs="http://www.oyjie.cn/tag/打包" style="font-size: 12px;" class="color3">打包</a>
                <a href="代码合并.htm" tppabs="http://www.oyjie.cn/tag/代码合并" style="font-size: 12px;" class="color3">代码合并</a>
                <a href="代码提交.htm" tppabs="http://www.oyjie.cn/tag/代码提交" style="font-size: 12px;" class="color3">代码提交</a>
                <a href="文本分析.htm" tppabs="http://www.oyjie.cn/tag/文本分析" style="font-size: 12px;" class="color3">文本分析</a>
                <a href="聚类.htm" tppabs="http://www.oyjie.cn/tag/聚类" style="font-size: 12px;" class="color3">聚类</a>
                <a href="分词.htm" tppabs="http://www.oyjie.cn/tag/分词" style="font-size: 12px;" class="color3">分词</a>
                <a href="WORD.htm" tppabs="http://www.oyjie.cn/tag/WORD" style="font-size: 12px;" class="color3">WORD</a>
                <a href="数据提取.htm" tppabs="http://www.oyjie.cn/tag/数据提取" style="font-size: 12px;" class="color3">数据提取</a>
                <a href="解析.htm" tppabs="http://www.oyjie.cn/tag/解析" style="font-size: 12px;" class="color3">解析</a>
                <a href="Word-1.htm" tppabs="http://www.oyjie.cn/tag/Word" style="font-size: 12px;" class="color3">Word</a>
                <a href="Tale.htm" tppabs="http://www.oyjie.cn/tag/Tale" style="font-size: 12px;" class="color3">Tale</a>
                <a href="项目经理.htm" tppabs="http://www.oyjie.cn/tag/项目经理" style="font-size: 12px;" class="color3">项目经理</a>
                <a href="项目管控.htm" tppabs="http://www.oyjie.cn/tag/项目管控" style="font-size: 12px;" class="color3">项目管控</a>
                <a href="邮件.htm" tppabs="http://www.oyjie.cn/tag/邮件" style="font-size: 12px;" class="color3">邮件</a>
                <a href="定时任务.htm" tppabs="http://www.oyjie.cn/tag/定时任务" style="font-size: 12px;" class="color3">定时任务</a>
                <a href="maillx.htm" tppabs="http://www.oyjie.cn/tag/maillx" style="font-size: 12px;" class="color3">maillx</a>
                <a href="搭建.htm" tppabs="http://www.oyjie.cn/tag/搭建" style="font-size: 12px;" class="color3">搭建</a>
                <a href="博客.htm" tppabs="http://www.oyjie.cn/tag/博客" style="font-size: 12px;" class="color3">博客</a>
                <a href="aaa.htm" tppabs="http://www.oyjie.cn/tag/aaa" style="font-size: 12px;" class="color3">aaa</a>
                <a href="心得.htm" tppabs="http://www.oyjie.cn/tag/心得" style="font-size: 12px;" class="color3">心得</a>
                <a href="linux.htm" tppabs="http://www.oyjie.cn/tag/linux" style="font-size: 12px;" class="color3">linux</a>
                <a href="tale-1.htm" tppabs="http://www.oyjie.cn/tag/tale" style="font-size: 12px;" class="color3">tale</a>
            </div>
        </section>
        <section class="tools-section tools-section-friends">
            <div class="friends-wrap" id="js-friends">
                <a target="_blank" class="main-nav-link switch-friends-link" href="javascript:if(confirm(%27http://mindhacks.cn/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://mindhacks.cn/%27" tppabs="http://mindhacks.cn/">刘未鹏 | Mind Hacks</a>
                <a target="_blank" class="main-nav-link switch-friends-link" href="javascript:if(confirm(%27http://www.xiashuo.online/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.xiashuo.online/%27" tppabs="http://www.xiashuo.online/">把灯瞎说的博客</a>
                <a target="_blank" class="main-nav-link switch-friends-link" href="javascript:if(confirm(%27http://biezhi.me/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://biezhi.me/%27" tppabs="http://biezhi.me/">王爵的技术博客</a>
            </div>
        </section>
        <section class="tools-section tools-section-me">
            <div class="aboutme-wrap" id="js-aboutme"></div>
        </section>
    </div>
</div>

    <div class="mid-col">
        <article class="article article-type-post  animated fadeInLeft" itemscope="" itemprop="blogPost">
            <div class="article-inner">
                <input type="hidden" class="isFancy">
                <header class="article-header">
                    <h1 itemprop="name">
                        <a name="title" class="article-title" href="4.htm" tppabs="http://www.oyjie.cn/article/4">#2017-09-17# CentOS自动发邮件</a>
                    </h1>
                </header>
                <div id="post-content" class="article-entry" itemprop="articleBody">
                    <p><h2>应用场景</h2>
<p>我们组有十几个人，安排了值日倒垃圾的表，但是总是有人会忘记，然后产品经理就将这个东西与个人绩效挂钩，少一次扣一分，这里用我的服务器把值日表里内容对应的人每天定时给他发邮件提醒。</p>
<h2>配置mail</h2>
<h3>查看mail是否已安装</h3>
<pre><code>[root@host ~]# mail
-bash: mail: command not found
[root@host ~]# witch mail
-bash: witch: command not found
[root@host ~]# which mail
/usr/bin/which: no mail in (/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin)
</code></pre>
<h3>不存在，安装</h3>
<pre><code>[root@host ~]# yum install mail
</code></pre>
<h3>配置mail</h3>
<ol>
<li>
<p>查看mail配置</p>
<pre><code> [root@host ~]# mail
 No mail for root
 [root@host ~]# which mail
 /bin/mail
</code></pre>
</li>
<li>
<p>没有配置账号</p>
<pre><code> [root@host etc]# vi mail.rc
 // 把这段加进去
 set from=账号 
 set smtp=邮件服务器地址
 set smtp-auth-user=账号 
 set smtp-auth-password=密码 
 set smtp-auth=login
</code></pre>
</li>
</ol>
<p>我用的是网易邮箱，对外的服务器地址有这些</p>
<p><img src="54a1qc21nih72ri9es3fm7fmhb.png" tppabs="http://www.oyjie.cn/upload/2017/09/54a1qc21nih72ri9es3fm7fmhb.png" alt="网易邮箱服务器信息" /></p>
<p>对了，这个密码需要邮箱的授权码，不是登录密码。</p>
<p>=_= 醉了，我的网易邮箱不能开启stmp服务，改用qq邮箱，stmp服务器是smtp.qq.com。</p>
<h2>配置sendmail</h2>
<h3>安装sendmail</h3>
<pre><code>yum install -y sendmail
</code></pre>
<h3>配置sendmail</h3>
<pre><code>sendmail -bd –q12h
</code></pre>
<ul>
<li>-b：设定Sendmail服务运行于后台。</li>
<li>-d：指定Sendmail以Daemon（守护进程）方式运行。</li>
<li>-q：设定当Sendmail无法成功发送邮件时，就将邮件保存在队列里，并指定保存时间。上面的12h表示保留12小时。</li>
</ul>
<p>此外，要检测Sendmail服务器是否正常运行，可以使用命令行：</p>
<pre><code>/etc/rc.d/init.d/sendmail status
</code></pre>
<h3>配置Senmail的SMTP认证</h3>
<pre><code>vi /etc/mail/sendmail.mc
</code></pre>
<p>esc,查找<code>/TRUST_AUTH_MECH</code>，去掉这两行</p>
<pre><code>dnl TRUST_AUTH_MECH(`EXTERNAL DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dnl
dnl define(`confAUTH_MECHANISMS', `EXTERNAL GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dnl
</code></pre>
<h3>网络访问权限</h3>
<p>esc，查找<code>/DAEMON_OPTIONS</code>，改为任意网段可访问</p>
<pre><code>DAEMON_OPTIONS(`Port=smtp,Addr=0.0.0.0, Name=MTA')dnl
</code></pre>
<h3>生成配置文件</h3>
<pre><code>[root#host ~]#m4 /etc/mail/sendmail.mc &gt; /etc/mail/sendmail.cf
m4:/etc/mail/sendmail.mc:10: cannot open `/usr/share/sendmail-cf/m4/cf.m4': No such file or directory
</code></pre>
<p>需要安装sendmail-cf</p>
<pre><code>yum install sendmail-cf
</code></pre>
<h3>重启sendmail</h3>
<pre><code>/etc/init.d/sendmail restart
</code></pre>
<h2>测试邮件发送</h2>
<pre><code>[root@host ~]# echo '文本内容！' | mail -s &quot;标题&quot; 1460300366@qq.com
smtp-server: 530 Error: A secure connection is requiered(such as ssl).......
</code></pre>
<h3>忽略ssl验证</h3>
<p>修改添加参数</p>
<pre><code>vi /etc/mail.rc
// 追加
set smtp-use-starttls
set ssl-verify=ignore
set nss-config-dir=/etc/pki/nssdb/
</code></pre>
<p>再试</p>
<pre><code>[root@host ~]# echo '文本内容！' | mail -s &quot;标题&quot; 1460300366@qq.com
Error in certificate: Peer's certificate issuer is not recognized.
</code></pre>
<h3>需要证书</h3>
<pre><code>mkdir -p /root/.certs/
echo -n | openssl s_client -connect smtp.qq.com:465 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' &gt; ~/.certs/qq.crt
certutil -A -n &quot;GeoTrust SSL CA&quot; -t &quot;C,,&quot; -d ~/.certs -i ~/.certs/qq.crt
certutil -A -n &quot;GeoTrust Global CA&quot; -t &quot;C,,&quot; -d ~/.certs -i ~/.certs/qq.crt
certutil -L -d /root/.certs
vi /etc/mail.rc
set nss-config-dir=/root/.certs
</code></pre>
<p>再试</p>
<pre><code>[root@host share]# echo '文本内容！' | mail -s &quot;标题&quot; 1460300366@qq.com
Error in certificate: Peer's certificate issuer is not recognized.
</code></pre>
<p>虽然<strong>证书报错</strong>没有验证，但是我收到了邮件，然后就是内容<strong>中文乱码</strong>。</p>
<p>证书报错可以这样解决</p>
<pre><code>cd /root/.certs
certutil -A -n &quot;GeoTrust SSL CA - G3&quot; -t &quot;Pu,Pu,Pu&quot;  -d ./ -i qq.crt 
</code></pre>
<p>中文乱码这样解决</p>
<pre><code>1）查看支持的字符集是否有GBK
[root@host ~]# locale -a
2) 安装英文版默认的字符集配置为：
[root@host ~]# cat /etc/sysconfig/i18n
LANG=&quot;en_US.UTF-8&quot;
SYSFONT=&quot;latarcyrheb-sun16&quot;
3) 修改为中文字符集:
[root@host ~]# vi /etc/sysconfig/i18n
LANG=&quot;zh_CN.GBK&quot;
SUPPORTED=&quot;zh_CN.UTF-8:zh_CN:zh&quot;
SYSFONT=&quot;latarcyrheb-sun16&quot;
4) 执行如下命令或者重启即可生效。
[root@host ~]# source /etc/sysconfig/i18n
</code></pre>
<p><img src="rjfutfvbkoi1eokfj375k9d01n.png" tppabs="http://www.oyjie.cn/upload/2017/09/rjfutfvbkoi1eokfj375k9d01n.png" alt="发送成功！" /></p>
<h2>脚本定时发送</h2>
<h3>发送邮件的脚本</h3>
<p>新建一个脚本</p>
<pre><code>[root@host ~]# touch /root/test.sh
[root@host ~]# chmod u+x /root/test.sh
[root@host ~]# vi /root/test.sh

#!/bin/csh
SENDDATE=`date`
echo &quot;定时测试，每天7点&quot; | /bin/mail -s &quot;邮件主题 - $SENDDATE&quot; 1460300366@qq.com
</code></pre>
<h3>添加定时任务</h3>
<p>让脚本定时自动运行，这个例子是每天7:00发送邮件</p>
<pre><code>[root@host ~]# echo &quot;00 07 * * * root /root/test.sh&quot; &gt;&gt; /etc/crontab
[root@host ~]# echo &gt;&gt; /etc/crontab
[root@host ~]# service crond reload
</code></pre>
<p>明天看下效果，然后就写实际应用脚本。</p>
<p>经检测执行命令前要加个sh，才能执行脚本，因为我那个开头写错了<code>/bin/csh</code>，应该是<code>/bin/bash</code>，否则会报错，不过用sh执行就不用管这个问题，并且也不需要确定有没有授权。</p>
<pre><code>[root@host ~]# /root/test.sh 
-bash: /root/test.sh: /bin/csh: bad interpreter: 没有那个文件或目录
</code></pre>
<p>我用每分钟一次的测试还是不行，发现可能是没有设置生效，重启一下服务</p>
<pre><code>*/1 * * * * root sh /root/test.sh
</code></pre>
<p>重启服务</p>
<pre><code>/etc/init.d/crond restart
</code></pre>
<p><img src="5mefa20flmihorekcmjhjeiv88.png" tppabs="http://www.oyjie.cn/upload/2017/09/5mefa20flmihorekcmjhjeiv88.png" alt="测试结果" /></p>
</p>
                    <p class="post-info">
                        本文由 <a href="">petterObam</a> 创作，采用 <a href="javascript:if(confirm(%27https://creativecommons.org/licenses/by/4.0/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed using an unsupported protocol (e.g., gopher).  \n\nDo you want to open it from the server?%27))window.location=%27https://creativecommons.org/licenses/by/4.0/%27" tppabs="https://creativecommons.org/licenses/by/4.0/"
                                                           target="_blank"
                                                           rel="external nofollow">知识共享署名4.0</a> 国际许可协议进行许可<br>本站文章除注明转载/出处外，均为本站原创或翻译，转载前请务必署名<br>最后编辑时间为:
                        2018/02/04 02:22
                    </p>
                </div>
                <div class="article-info article-info-index">
                    <div class="article-tag tagcloud">
                        <i class="icon-price-tags"></i>
                        <ul class="article-tag-list">
                            <li class="article-tag-list-item"><a class="color3" href="#"
                                                                 style="font-size: 12px;"><a href="CentOs.htm" tppabs="http://www.oyjie.cn/tag/CentOs">CentOs</a><a href="maillx.htm" tppabs="http://www.oyjie.cn/tag/maillx">maillx</a><a href="定时任务-1.htm" tppabs="http://www.oyjie.cn/tag/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1">定时任务</a><a href="邮件-1.htm" tppabs="http://www.oyjie.cn/tag/%E9%82%AE%E4%BB%B6">邮件</a></a></li>
                        </ul>
                    </div>
                    <div class="post-data archive-article-date">
                        <time datetime="2017-09-16" itemprop="datePublished">发布于 2017-09-16
                        </time>
                        /<span> <a href="邮件-2.htm" tppabs="http://www.oyjie.cn/category/%E9%82%AE%E4%BB%B6">邮件</a><a href="CentOs-1.htm" tppabs="http://www.oyjie.cn/category/CentOs">CentOs</a> </span>/ <a href="#comments">1 条评论</a> /
                        110浏览<a name="footer">.</a>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </article>

		<div id="post-bottom-bar" class="post-bottom-bar">
		    <div class="bottom-bar-inner">
		        <div class="bottom-bar-items social-share left">
		            <span class="bottom-bar-item">Share : </span>
		            <span class="bottom-bar-item bottom-bar-facebook"><a href="javascript:if(confirm(%27https://www.facebook.com/sharer/sharer.php?u=http://www.oyjie.cn/article/4  \n\nThis file was not retrieved by Teleport Pro, because it is addressed using an unsupported protocol (e.g., gopher).  \n\nDo you want to open it from the server?%27))window.location=%27https://www.facebook.com/sharer/sharer.php?u=http://www.oyjie.cn/article/4%27" tppabs="https://www.facebook.com/sharer/sharer.php?u=http://www.oyjie.cn/article/4" target="_blank" title="#2017-09-17# CentOS自动发邮件" rel="nofollow">facebook</a></span>
		            <span class="bottom-bar-item bottom-bar-twitter"><a href="javascript:if(confirm(%27https://twitter.com/intent/tweet?url=http://www.oyjie.cn/article/4&text=  \n\nThis file was not retrieved by Teleport Pro, because it is addressed using an unsupported protocol (e.g., gopher).  \n\nDo you want to open it from the server?%27))window.location=%27https://twitter.com/intent/tweet?url=http://www.oyjie.cn/article/4&text=#2017-09-17# CentOS自动发邮件%27" tppabs="https://twitter.com/intent/tweet?url=http://www.oyjie.cn/article/4&text=#2017-09-17# CentOS自动发邮件" target="_blank" title="#2017-09-17# CentOS自动发邮件" rel="nofollow">Twitter</a></span>
		            <span class="bottom-bar-item bottom-bar-weibo"><a href="javascript:if(confirm(%27http://service.weibo.com/share/share.php?url=http://www.oyjie.cn/article/4&title=  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://service.weibo.com/share/share.php?url=http://www.oyjie.cn/article/4&title=#2017-09-17# CentOS自动发邮件%27" tppabs="http://service.weibo.com/share/share.php?url=http://www.oyjie.cn/article/4&title=#2017-09-17# CentOS自动发邮件" target="_blank" title="#2017-09-17# CentOS自动发邮件" rel="nofollow">Weibo</a></span>
		            <span class="bottom-bar-item bottom-bar-qrcode"><a href="javascript:if(confirm(%27http://pan.baidu.com/share/qrcode?w=300&h=300&url=http://www.oyjie.cn/article/4  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://pan.baidu.com/share/qrcode?w=300&h=300&url=http://www.oyjie.cn/article/4%27" tppabs="http://pan.baidu.com/share/qrcode?w=300&h=300&url=http://www.oyjie.cn/article/4" target="_blank" rel="nofollow">QRcode</a></span>
		        </div>
		        <div class="bottom-bar-items right">
		            <span class="bottom-bar-item"><a href="3.htm" tppabs="http://www.oyjie.cn/article/3" title="#2017-09-10# Tale模板框架博客搭建记录">→</a></span>
		            <span class="bottom-bar-item"><a href="5.htm" tppabs="http://www.oyjie.cn/article/5" title="#2017-09-22# 初体验·项目管控心得">←</a></span>
		            <span class="bottom-bar-item"><a href="#footer">↓</a></span>
		            <span class="bottom-bar-item"><a href="#title">↑</a></span>
		        </div>
		    </div>
		</div>
		
        <div id="4" class="comment-container">
    <div id="comments" class="clearfix">
        <span class="response"></span>

        <form method="post" id="comment-form" class="comment-form" role="form" onsubmit="return TaleComment.subComment();">
            <input type="hidden" name="coid" id="coid"/>
            <input type="hidden" name="cid" id="cid" value="4"/>
            <input type="hidden" name="_csrf_token" value="QMcWCnP4F1miWfZPplPKd0"/>
            <input type="text" name="author" maxlength="12" id="author" class="form-control input-control clearfix"
                   placeholder="姓名 (*)" value="" required/>
            <input type="email" name="mail" id="mail" class="form-control input-control clearfix" placeholder="邮箱 (*)"
                   value="" required/>
            <input type="url" name="url" id="url" class="form-control input-control clearfix" placeholder="网址 (http://)"
                   value=""/>
            <textarea name="text" id="textarea" class="form-control" placeholder="请留下你的评论..." required minlength="5" maxlength="2000"></textarea>
            <button type="submit" class="submit" id="misubmit">提交</button>
        </form><br/>




        <ol class="comment-list">
            <li id="li-comment-4" class="comment-body comment-parent comment-odd">
                <div id="comment-4">
                    <div class="comment-view" onclick="">
                        <div class="comment-header">
                            <img class="avatar" src="7a3b4d2e8fc3f271e875a60ad76bc150-s=80&r=G&d=" tppabs="https://secure.gravatar.com/avatar/7a3b4d2e8fc3f271e875a60ad76bc150?s=80&r=G&d=" title="瞎说"
                                 width="80" height="80">
                            <span class="comment-author">
                                <a href="" target="_blank" rel="external nofollow">瞎说</a>
                            </span>
                        </div>
                        <div class="comment-content">
                            <span class="comment-author-at"></span>
                            <p><p>sixsixsix</p>
</p>
                        </div>
                        <div class="comment-meta">
                            <time class="comment-time">2017-09-16</time>
                            <span class="comment-reply">
                                <a rel="nofollow" onclick="TaleComment.reply('4');">回复</a>
                            </span>
                        </div>
                    </div>
                </div>
            </li>
        </ol>
        <div class="lists-navigator clearfix">
            <ol class="page-navigator">
                <li  class="current" ><a href="4-cp=1.htm#comments" tppabs="http://www.oyjie.cn/article/4?cp=1#comments">1</a></li>
            </ol>
            <br/><br/>
        </div>
    </div>
</div>
<script type="text/javascript">
(function () {
    window.TaleComment = {
        reply : function (coid) {
            $('#comment-form input[name=coid]').val(coid);
            $("html,body").animate({scrollTop: $('div.comment-container').offset().top}, 500);
            $('#comment-form #textarea').focus();
        },
        subComment: function () {
            $.ajax({
                type: 'post',
                url: '/comment',
                data: $('#comment-form').serialize(),
                async: false,
                dataType: 'json',
                success: function (result) {
                    $('#comment-form input[name=coid]').val('');
                    if (result && result.success) {
                        window.location.reload();
                    } else {
                        if (result.msg) {
                            alert(result.msg);
                        }
                    }
                }
            });
            return false;
        }
    };
})();
function getCommentCookie(name){
    var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
    if(arr=document.cookie.match(reg))
        return unescape(decodeURI(arr[2]));
    else
        return null;
}
function addCommentInputValue(){
    document.getElementById('author').value = getCommentCookie('tale_remember_author');
    document.getElementById('mail').value = getCommentCookie('tale_remember_mail');
    document.getElementById('url').value = getCommentCookie('tale_remember_url');
}
function setDefaultInputValue(){
	var authorInput = $('#comment-form input[name=author]');
	var mailInput = $('#comment-form input[name=mail]');
	var author = authorInput.val();
	if(null == author || "" == author){
		var timestamp=new Date().getTime();
		authorInput.val("路人" + timestamp);
	}
	var mail = mailInput.val();
	if(null == mail || "" == mail){
		mailInput.val("user@mail.com.htm"/*tpa=http://www.oyjie.cn/article/user@mail.com*/);
	}
}
addCommentInputValue();
setDefaultInputValue();
</script>
    </div>
</div>
<div id="directory-content" class="directory-content">
    <div id="directory"></div>
</div>
<script>
    $('#directory').html('<a id="openHiddenLinkId" href="javascript:void(0)" isopen="0" style="display:block;float:right;z-index: 2000;">↗</a><p style="text-align: center;padding-bottom: 5px;color: #08c;">目录</p>');
    var postDirectoryBuild = function() {
        $("#openHiddenLinkId").click(function(){
            var isopen = $(this).attr("isopen");
            if(isopen == "1"){
              $('#directory').find("p,ul").show(200);
              $(this).attr("isopen","0").html("↗");
            }else{
              $('#directory').find("p,ul").hide(200);
              $(this).attr("isopen","1").html("↙");
            }
        });
        var postChildren = function children(childNodes, reg) {
                var result = [],
                    isReg = typeof reg === 'object',
                    isStr = typeof reg === 'string',
                    node, i, len;
                for (i = 0, len = childNodes.length; i < len; i++) {
                    node = childNodes[i];
                    if ((node.nodeType === 1 || node.nodeType === 9) &&
                        (!reg ||
                        isReg && reg.test(node.tagName.toLowerCase()) ||
                        isStr && node.tagName.toLowerCase() === reg)) {
                        result.push(node);
                    }
                }
                return result;
            },
            createPostDirectory = function(article, directory, isDirNum) {
                var contentArr = [],
                    titleId = [],
                    levelArr, root, level,
                    currentList, list, li, link, i, len;
                levelArr = (function(article, contentArr, titleId) {
                    var titleElem = postChildren(article.childNodes, /^h\d$/),
                        levelArr = [],
                        lastNum = 1,
                        lastRevNum = 1,
                        count = 0,
                        guid = 1,
                        id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                        lastRevNum, num, elem;
                    while (titleElem.length) {
                        elem = titleElem.shift();
                        contentArr.push(elem.innerHTML);
                        num = +elem.tagName.match(/\d/)[0];
                        if (num > lastNum) {
                            levelArr.push(1);
                            lastRevNum += 1;
                        } else if (num === lastRevNum ||
                            num > lastRevNum && num <= lastNum) {
                            levelArr.push(0);
                            lastRevNum = lastRevNum;
                        } else if (num < lastRevNum) {
                            levelArr.push(num - lastRevNum);
                            lastRevNum = num;
                        }
                        count += levelArr[levelArr.length - 1];
                        lastNum = num;
                        elem.id = elem.id || (id + guid++);
                        titleId.push(elem.id);
                    }
                    if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                    return levelArr;
                })(article, contentArr, titleId);
                currentList = root = document.createElement('ul');
                dirNum = [0];
                for (i = 0, len = levelArr.length; i < len; i++) {
                    level = levelArr[i];
                    if (level === 1) {
                        list = document.createElement('ul');
                        if (!currentList.lastElementChild) {
                            currentList.appendChild(document.createElement('li'));
                        }
                        currentList.lastElementChild.appendChild(list);
                        currentList = list;
                        dirNum.push(0);
                    } else if (level < 0) {
                        level *= 2;
                        while (level++) {
                            if (level % 2) dirNum.pop();
                            currentList = currentList.parentNode;
                        }
                    }
                    dirNum[dirNum.length - 1]++;
                    li = document.createElement('li');
                    link = document.createElement('a');
                    link.href = '#' + titleId[i];
                    link.innerHTML = !isDirNum ? contentArr[i] :
                        dirNum.join('.') + ' ' + contentArr[i] ;
                    li.appendChild(link);
                    currentList.appendChild(li);
                }
                directory.appendChild(root);
            };
        createPostDirectory(document.getElementById('post-content'),document.getElementById('directory'), true);
    };
    postDirectoryBuild();
</script>
<script src="prism.js" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/js/prism.js"></script>
<div id="particles"></div>
<script src="particle.js" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/js/particle.js"></script>

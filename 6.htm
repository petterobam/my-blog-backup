<div id="container">
    <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-transform"/>
    <meta name="sogou_site_verification" content="xSIboraCiG"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta name="keywords" content="Word,PDF,解析,数据提取"/>
    <meta name="description" content="一段代码，一个故事"/>
    <link rel="shortcut icon" href="favicon.png" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/img/favicon.png"/>
    <link rel="apple-touch-icon" href="apple-touch-icon.png" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/img/apple-touch-icon.png"/>
    <script src="main.js" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/js/main.js"></script>
    <link href="style.min.css" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/css/style.min.css" rel="stylesheet">
    <link href="prism.css" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/css/prism.css" rel="stylesheet">
    <title>#2017-10-25# Word、PDF解析项目（一） - petterObam</title>
    <script src="particles.min.js" tppabs="http://cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
</head>
<body  gtools_scp_screen_capture_injected="true">
<!--[if lt IE 8]>
<div class="browsehappy" role="dialog">
    当前网页 <strong>不支持</strong> 你正在使用的浏览器. 为了正常的访问, 请 <a href="javascript:if(confirm(%27http://browsehappy.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://browsehappy.com/%27" tppabs="http://browsehappy.com/" target="_blank">升级你的浏览器</a>。
</div>
<![endif]-->
<div class="left-col">
    <div class="overlay"></div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="index.htm" tppabs="http://www.oyjie.cn/" class="profilepic">
                <img src="logo.png.jpg" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/img/logo.png" class="js-avatar">
            </a>
            <hgroup>
                <h1 class="header-author"><a href="index.htm" tppabs="http://www.oyjie.cn/">petterObam</a></h1>
                <p class="subtitle">一段代码，一个故事</p>
            </hgroup>
            <nav class="header-menu">
                <ul>
                    <li><a href="index.htm" tppabs="http://www.oyjie.cn/">主页</a></li>
                </ul>
            </nav>
            <nav class="header-smart-menu">
                <a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
                <a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
                <a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
                <a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
            </nav>
            <nav class="header-nav">
                <div class="social">


                    <a class="social rss" target="blank" href="feed.htm" tppabs="http://www.oyjie.cn/feed">RSS</a>

                    <!---->
                    <a class="github" target="blank"
                       href="javascript:if(confirm(%27https://github.com/petterobam  \n\nThis file was not retrieved by Teleport Pro, because it is addressed using an unsupported protocol (e.g., gopher).  \n\nDo you want to open it from the server?%27))window.location=%27https://github.com/petterobam%27" tppabs="https://github.com/petterobam">Github</a>
                    

                </div>
            </nav>
        </header>
    </div>
</div>
<div class="tools-col">
    <ul class="btn-wrap">
        <li class="" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
        <li data-hook="tools-section-tag" class="chose"><span class="text"></span><i class="icon-price-tags"></i></li>
        <li data-hook="tools-section-friends" class=""><span class="text">友链</span><i class="icon-link"></i></li>
        <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    </ul>
    <div class="tools-wrap">
        <section class="tools-section tools-section-all">

        </section>
        <section class="tools-section tools-section-tag chose">
            <div class="widget tagcloud" id="js-tagcloud">
                <a href="PDF.htm" tppabs="http://www.oyjie.cn/tag/PDF" style="font-size: 12px;" class="color3">PDF</a>
                <a href="CentOs.htm" tppabs="http://www.oyjie.cn/tag/CentOs" style="font-size: 12px;" class="color3">CentOs</a>
                <a href="sqlite.htm" tppabs="http://www.oyjie.cn/tag/sqlite" style="font-size: 12px;" class="color3">sqlite</a>
                <a href="面向对象.htm" tppabs="http://www.oyjie.cn/tag/面向对象" style="font-size: 12px;" class="color3">面向对象</a>
                <a href="封装.htm" tppabs="http://www.oyjie.cn/tag/封装" style="font-size: 12px;" class="color3">封装</a>
                <a href="数据库.htm" tppabs="http://www.oyjie.cn/tag/数据库" style="font-size: 12px;" class="color3">数据库</a>
                <a href="打包.htm" tppabs="http://www.oyjie.cn/tag/打包" style="font-size: 12px;" class="color3">打包</a>
                <a href="代码合并.htm" tppabs="http://www.oyjie.cn/tag/代码合并" style="font-size: 12px;" class="color3">代码合并</a>
                <a href="代码提交.htm" tppabs="http://www.oyjie.cn/tag/代码提交" style="font-size: 12px;" class="color3">代码提交</a>
                <a href="文本分析.htm" tppabs="http://www.oyjie.cn/tag/文本分析" style="font-size: 12px;" class="color3">文本分析</a>
                <a href="聚类.htm" tppabs="http://www.oyjie.cn/tag/聚类" style="font-size: 12px;" class="color3">聚类</a>
                <a href="分词.htm" tppabs="http://www.oyjie.cn/tag/分词" style="font-size: 12px;" class="color3">分词</a>
                <a href="WORD.htm" tppabs="http://www.oyjie.cn/tag/WORD" style="font-size: 12px;" class="color3">WORD</a>
                <a href="数据提取.htm" tppabs="http://www.oyjie.cn/tag/数据提取" style="font-size: 12px;" class="color3">数据提取</a>
                <a href="解析.htm" tppabs="http://www.oyjie.cn/tag/解析" style="font-size: 12px;" class="color3">解析</a>
                <a href="Word-1.htm" tppabs="http://www.oyjie.cn/tag/Word" style="font-size: 12px;" class="color3">Word</a>
                <a href="Tale.htm" tppabs="http://www.oyjie.cn/tag/Tale" style="font-size: 12px;" class="color3">Tale</a>
                <a href="项目经理.htm" tppabs="http://www.oyjie.cn/tag/项目经理" style="font-size: 12px;" class="color3">项目经理</a>
                <a href="项目管控.htm" tppabs="http://www.oyjie.cn/tag/项目管控" style="font-size: 12px;" class="color3">项目管控</a>
                <a href="邮件.htm" tppabs="http://www.oyjie.cn/tag/邮件" style="font-size: 12px;" class="color3">邮件</a>
                <a href="定时任务.htm" tppabs="http://www.oyjie.cn/tag/定时任务" style="font-size: 12px;" class="color3">定时任务</a>
                <a href="maillx.htm" tppabs="http://www.oyjie.cn/tag/maillx" style="font-size: 12px;" class="color3">maillx</a>
                <a href="搭建.htm" tppabs="http://www.oyjie.cn/tag/搭建" style="font-size: 12px;" class="color3">搭建</a>
                <a href="博客.htm" tppabs="http://www.oyjie.cn/tag/博客" style="font-size: 12px;" class="color3">博客</a>
                <a href="aaa.htm" tppabs="http://www.oyjie.cn/tag/aaa" style="font-size: 12px;" class="color3">aaa</a>
                <a href="心得.htm" tppabs="http://www.oyjie.cn/tag/心得" style="font-size: 12px;" class="color3">心得</a>
                <a href="linux.htm" tppabs="http://www.oyjie.cn/tag/linux" style="font-size: 12px;" class="color3">linux</a>
                <a href="tale-1.htm" tppabs="http://www.oyjie.cn/tag/tale" style="font-size: 12px;" class="color3">tale</a>
            </div>
        </section>
        <section class="tools-section tools-section-friends">
            <div class="friends-wrap" id="js-friends">
                <a target="_blank" class="main-nav-link switch-friends-link" href="javascript:if(confirm(%27http://mindhacks.cn/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://mindhacks.cn/%27" tppabs="http://mindhacks.cn/">刘未鹏 | Mind Hacks</a>
                <a target="_blank" class="main-nav-link switch-friends-link" href="javascript:if(confirm(%27http://www.xiashuo.online/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.xiashuo.online/%27" tppabs="http://www.xiashuo.online/">把灯瞎说的博客</a>
                <a target="_blank" class="main-nav-link switch-friends-link" href="javascript:if(confirm(%27http://biezhi.me/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://biezhi.me/%27" tppabs="http://biezhi.me/">王爵的技术博客</a>
            </div>
        </section>
        <section class="tools-section tools-section-me">
            <div class="aboutme-wrap" id="js-aboutme"></div>
        </section>
    </div>
</div>

    <div class="mid-col">
        <article class="article article-type-post  animated fadeInLeft" itemscope="" itemprop="blogPost">
            <div class="article-inner">
                <input type="hidden" class="isFancy">
                <header class="article-header">
                    <h1 itemprop="name">
                        <a name="title" class="article-title" href="6.htm" tppabs="http://www.oyjie.cn/article/6">#2017-10-25# Word、PDF解析项目（一）</a>
                    </h1>
                </header>
                <div id="post-content" class="article-entry" itemprop="articleBody">
                    <p><h2>前情提要</h2>
<p>前一段时间做了文档解析相关的微服务，当然是和业务背景相关的业务数据提取，并不是对任何文档都能提取出正确的数据，而是针对旅行社的线路行程文档做的针对性解析服务。</p>
<h2>应用场景</h2>
<p>旅游行业供应商旅行社使用的B端软件有一个痛点，就是线路行程数据录入复杂耗时。由于不同旅行社线路行程文档风格几乎都不相同，即便是同一旅行社不同计调做出的文档风格也有所差异，即便是同一计调针对不同的类别的线路在不同的时期做出的文档也会有所不同。甚至有些旅行社是作为代理商，拿他们的产品做分销，又有更多无法控制的情况。如果按照常规做法，每一种风格的文档做一种文档模板（Word+PDF），每一种模板对应一种解析方式，这将是无法估计的工作量，特别在软件线路行程文档或业务数据若有变动的话，会有很大的迭代成本，相应的的维护代价和门槛也会变高。但是如果不做文档模板，如何保证准确性和稳定性呢，如何保证工作量可估量，如何保证后续的稳定迭代和有效的维护。</p>
<h2>项目设计</h2>
<p>项目启动初，需要给一个初步的项目设计，下面是项目内部的结构设计：</p>
<p><img src="sovpst1pemgfpo1dek227p0hm3.png" tppabs="http://www.oyjie.cn/upload/2017/10/sovpst1pemgfpo1dek227p0hm3.png" alt="项目框架设计" /></p>
<p>简化起来大概就是这个样子：</p>
<p><img src="oeuh04e7eei4voal7r261gpsjh.png" tppabs="http://www.oyjie.cn/upload/2017/10/oeuh04e7eei4voal7r261gpsjh.png" alt="项目框架设计" /></p>
<h2>时间计划</h2>
<p>项目启动后，需要给一个简要的功能计划和时间的预估：</p>
<p><img src="1r5a0svnjainsoo89q7t5p9apt.png" tppabs="http://www.oyjie.cn/upload/2017/10/1r5a0svnjainsoo89q7t5p9apt.png" alt="项目框架设计" /></p>
<h2>框架架构</h2>
<ul>
<li>精简 SpringMVC+Spring+Mybatis 框架配置；</li>
<li>支持druid控制台，监控请求、数据库和服务方法的性能；</li>
<li>支持页面和Controller交互，JSON和对象的自动互相转换；</li>
<li>提供公共服务，也支持按业务线扩展开发；</li>
<li>支持JUNIT4测试和日志监控功能；</li>
<li>支持事务监控，自定义监控；</li>
</ul>
<h2>功能清单</h2>
<ol>
<li>文件读取解析 框架搭建</li>
<li>文件工厂实现</li>
<li>文件读取适配器实现 搭建</li>
<li>DOC读取适配器实现文档转HTML/XHTML，及其相关预处理</li>
<li>DOCX读取适配器实现文档转HTML/XHTML，及其相关预处理</li>
<li>PDF读取适配器实现文档转HTML/XHTML，及其相关预处理</li>
<li>HTML读取、解析器实现</li>
<li>文件对外读取服务实现</li>
<li>解析区模块构建分析</li>
<li>文本切块定义和设计</li>
<li>文本切块实现</li>
<li>元素扣取定义实现</li>
<li>正则匹配定义实现</li>
<li>业务方解析转化模式搭建和设计</li>
<li>旅游业务线路、行程和团队规则数据结构设计和定义</li>
<li>线路行程数据加工以及旅游对外服务实现，接收文件或文件地址解析</li>
<li>高级配置界面设计</li>
<li>高级配置界面实现</li>
<li>ASMS对接服务导入WORD文档自动生成线路</li>
<li>ASMS对接服务导入WORD文档自自动生成行程</li>
<li>串联所有模块进行测试，实现线路、行程自动导入</li>
</ol>
<h2>后续</h2>
<p>细节实现和项目过程中遇到的问题后续更新...</p>
</p>
                    <p class="post-info">
                        本文由 <a href="">petterObam</a> 创作，采用 <a href="javascript:if(confirm(%27https://creativecommons.org/licenses/by/4.0/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed using an unsupported protocol (e.g., gopher).  \n\nDo you want to open it from the server?%27))window.location=%27https://creativecommons.org/licenses/by/4.0/%27" tppabs="https://creativecommons.org/licenses/by/4.0/"
                                                           target="_blank"
                                                           rel="external nofollow">知识共享署名4.0</a> 国际许可协议进行许可<br>本站文章除注明转载/出处外，均为本站原创或翻译，转载前请务必署名<br>最后编辑时间为:
                        2018/02/04 02:21
                    </p>
                </div>
                <div class="article-info article-info-index">
                    <div class="article-tag tagcloud">
                        <i class="icon-price-tags"></i>
                        <ul class="article-tag-list">
                            <li class="article-tag-list-item"><a class="color3" href="#"
                                                                 style="font-size: 12px;"><a href="Word-1.htm" tppabs="http://www.oyjie.cn/tag/Word">Word</a><a href="PDF.htm" tppabs="http://www.oyjie.cn/tag/PDF">PDF</a><a href="javascript:if(confirm(%27http://www.oyjie.cn/tag/%E8%A7%A3%E6%9E%90  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.oyjie.cn/tag/%E8%A7%A3%E6%9E%90%27" tppabs="http://www.oyjie.cn/tag/%E8%A7%A3%E6%9E%90">解析</a><a href="数据提取-1.htm" tppabs="http://www.oyjie.cn/tag/%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96">数据提取</a></a></li>
                        </ul>
                    </div>
                    <div class="post-data archive-article-date">
                        <time datetime="2017-10-25" itemprop="datePublished">发布于 2017-10-25
                        </time>
                        /<span> <a href="体会.htm" tppabs="http://www.oyjie.cn/category/%E4%BD%93%E4%BC%9A">体会</a><a href="框架.htm" tppabs="http://www.oyjie.cn/category/%E6%A1%86%E6%9E%B6">框架</a> </span>/ <a href="#comments">没有评论</a> /
                        120浏览<a name="footer">.</a>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </article>

		<div id="post-bottom-bar" class="post-bottom-bar">
		    <div class="bottom-bar-inner">
		        <div class="bottom-bar-items social-share left">
		            <span class="bottom-bar-item">Share : </span>
		            <span class="bottom-bar-item bottom-bar-facebook"><a href="javascript:if(confirm(%27https://www.facebook.com/sharer/sharer.php?u=http://www.oyjie.cn/article/6  \n\nThis file was not retrieved by Teleport Pro, because it is addressed using an unsupported protocol (e.g., gopher).  \n\nDo you want to open it from the server?%27))window.location=%27https://www.facebook.com/sharer/sharer.php?u=http://www.oyjie.cn/article/6%27" tppabs="https://www.facebook.com/sharer/sharer.php?u=http://www.oyjie.cn/article/6" target="_blank" title="#2017-10-25# Word、PDF解析项目（一）" rel="nofollow">facebook</a></span>
		            <span class="bottom-bar-item bottom-bar-twitter"><a href="javascript:if(confirm(%27https://twitter.com/intent/tweet?url=http://www.oyjie.cn/article/6&text=  \n\nThis file was not retrieved by Teleport Pro, because it is addressed using an unsupported protocol (e.g., gopher).  \n\nDo you want to open it from the server?%27))window.location=%27https://twitter.com/intent/tweet?url=http://www.oyjie.cn/article/6&text=#2017-10-25# Word、PDF解析项目（一）%27" tppabs="https://twitter.com/intent/tweet?url=http://www.oyjie.cn/article/6&text=#2017-10-25# Word、PDF解析项目（一）" target="_blank" title="#2017-10-25# Word、PDF解析项目（一）" rel="nofollow">Twitter</a></span>
		            <span class="bottom-bar-item bottom-bar-weibo"><a href="javascript:if(confirm(%27http://service.weibo.com/share/share.php?url=http://www.oyjie.cn/article/6&title=  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://service.weibo.com/share/share.php?url=http://www.oyjie.cn/article/6&title=#2017-10-25# Word、PDF解析项目（一）%27" tppabs="http://service.weibo.com/share/share.php?url=http://www.oyjie.cn/article/6&title=#2017-10-25# Word、PDF解析项目（一）" target="_blank" title="#2017-10-25# Word、PDF解析项目（一）" rel="nofollow">Weibo</a></span>
		            <span class="bottom-bar-item bottom-bar-qrcode"><a href="javascript:if(confirm(%27http://pan.baidu.com/share/qrcode?w=300&h=300&url=http://www.oyjie.cn/article/6  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://pan.baidu.com/share/qrcode?w=300&h=300&url=http://www.oyjie.cn/article/6%27" tppabs="http://pan.baidu.com/share/qrcode?w=300&h=300&url=http://www.oyjie.cn/article/6" target="_blank" rel="nofollow">QRcode</a></span>
		        </div>
		        <div class="bottom-bar-items right">
		            <span class="bottom-bar-item"><a href="3.htm" tppabs="http://www.oyjie.cn/article/3" title="#2017-09-10# Tale模板框架博客搭建记录">→</a></span>
		            <span class="bottom-bar-item"><a href="7.htm" tppabs="http://www.oyjie.cn/article/7" title="#2017-11-06# Word、PDF解析项目（二）">←</a></span>
		            <span class="bottom-bar-item"><a href="#footer">↓</a></span>
		            <span class="bottom-bar-item"><a href="#title">↑</a></span>
		        </div>
		    </div>
		</div>
		
        <div id="6" class="comment-container">
    <div id="comments" class="clearfix">
        <span class="response"></span>

        <form method="post" id="comment-form" class="comment-form" role="form" onsubmit="return TaleComment.subComment();">
            <input type="hidden" name="coid" id="coid"/>
            <input type="hidden" name="cid" id="cid" value="6"/>
            <input type="hidden" name="_csrf_token" value="z1pD3xrjHJTV7MRRqiRrX-"/>
            <input type="text" name="author" maxlength="12" id="author" class="form-control input-control clearfix"
                   placeholder="姓名 (*)" value="" required/>
            <input type="email" name="mail" id="mail" class="form-control input-control clearfix" placeholder="邮箱 (*)"
                   value="" required/>
            <input type="url" name="url" id="url" class="form-control input-control clearfix" placeholder="网址 (http://)"
                   value=""/>
            <textarea name="text" id="textarea" class="form-control" placeholder="请留下你的评论..." required minlength="5" maxlength="2000"></textarea>
            <button type="submit" class="submit" id="misubmit">提交</button>
        </form><br/>




    </div>
</div>
<script type="text/javascript">
(function () {
    window.TaleComment = {
        reply : function (coid) {
            $('#comment-form input[name=coid]').val(coid);
            $("html,body").animate({scrollTop: $('div.comment-container').offset().top}, 500);
            $('#comment-form #textarea').focus();
        },
        subComment: function () {
            $.ajax({
                type: 'post',
                url: '/comment',
                data: $('#comment-form').serialize(),
                async: false,
                dataType: 'json',
                success: function (result) {
                    $('#comment-form input[name=coid]').val('');
                    if (result && result.success) {
                        window.location.reload();
                    } else {
                        if (result.msg) {
                            alert(result.msg);
                        }
                    }
                }
            });
            return false;
        }
    };
})();
function getCommentCookie(name){
    var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
    if(arr=document.cookie.match(reg))
        return unescape(decodeURI(arr[2]));
    else
        return null;
}
function addCommentInputValue(){
    document.getElementById('author').value = getCommentCookie('tale_remember_author');
    document.getElementById('mail').value = getCommentCookie('tale_remember_mail');
    document.getElementById('url').value = getCommentCookie('tale_remember_url');
}
function setDefaultInputValue(){
	var authorInput = $('#comment-form input[name=author]');
	var mailInput = $('#comment-form input[name=mail]');
	var author = authorInput.val();
	if(null == author || "" == author){
		var timestamp=new Date().getTime();
		authorInput.val("路人" + timestamp);
	}
	var mail = mailInput.val();
	if(null == mail || "" == mail){
		mailInput.val("user@mail.com.htm"/*tpa=http://www.oyjie.cn/article/user@mail.com*/);
	}
}
addCommentInputValue();
setDefaultInputValue();
</script>
    </div>
</div>
<div id="directory-content" class="directory-content">
    <div id="directory"></div>
</div>
<script>
    $('#directory').html('<a id="openHiddenLinkId" href="javascript:void(0)" isopen="0" style="display:block;float:right;z-index: 2000;">↗</a><p style="text-align: center;padding-bottom: 5px;color: #08c;">目录</p>');
    var postDirectoryBuild = function() {
        $("#openHiddenLinkId").click(function(){
            var isopen = $(this).attr("isopen");
            if(isopen == "1"){
              $('#directory').find("p,ul").show(200);
              $(this).attr("isopen","0").html("↗");
            }else{
              $('#directory').find("p,ul").hide(200);
              $(this).attr("isopen","1").html("↙");
            }
        });
        var postChildren = function children(childNodes, reg) {
                var result = [],
                    isReg = typeof reg === 'object',
                    isStr = typeof reg === 'string',
                    node, i, len;
                for (i = 0, len = childNodes.length; i < len; i++) {
                    node = childNodes[i];
                    if ((node.nodeType === 1 || node.nodeType === 9) &&
                        (!reg ||
                        isReg && reg.test(node.tagName.toLowerCase()) ||
                        isStr && node.tagName.toLowerCase() === reg)) {
                        result.push(node);
                    }
                }
                return result;
            },
            createPostDirectory = function(article, directory, isDirNum) {
                var contentArr = [],
                    titleId = [],
                    levelArr, root, level,
                    currentList, list, li, link, i, len;
                levelArr = (function(article, contentArr, titleId) {
                    var titleElem = postChildren(article.childNodes, /^h\d$/),
                        levelArr = [],
                        lastNum = 1,
                        lastRevNum = 1,
                        count = 0,
                        guid = 1,
                        id = 'directory' + (Math.random() + '').replace(/\D/, ''),
                        lastRevNum, num, elem;
                    while (titleElem.length) {
                        elem = titleElem.shift();
                        contentArr.push(elem.innerHTML);
                        num = +elem.tagName.match(/\d/)[0];
                        if (num > lastNum) {
                            levelArr.push(1);
                            lastRevNum += 1;
                        } else if (num === lastRevNum ||
                            num > lastRevNum && num <= lastNum) {
                            levelArr.push(0);
                            lastRevNum = lastRevNum;
                        } else if (num < lastRevNum) {
                            levelArr.push(num - lastRevNum);
                            lastRevNum = num;
                        }
                        count += levelArr[levelArr.length - 1];
                        lastNum = num;
                        elem.id = elem.id || (id + guid++);
                        titleId.push(elem.id);
                    }
                    if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

                    return levelArr;
                })(article, contentArr, titleId);
                currentList = root = document.createElement('ul');
                dirNum = [0];
                for (i = 0, len = levelArr.length; i < len; i++) {
                    level = levelArr[i];
                    if (level === 1) {
                        list = document.createElement('ul');
                        if (!currentList.lastElementChild) {
                            currentList.appendChild(document.createElement('li'));
                        }
                        currentList.lastElementChild.appendChild(list);
                        currentList = list;
                        dirNum.push(0);
                    } else if (level < 0) {
                        level *= 2;
                        while (level++) {
                            if (level % 2) dirNum.pop();
                            currentList = currentList.parentNode;
                        }
                    }
                    dirNum[dirNum.length - 1]++;
                    li = document.createElement('li');
                    link = document.createElement('a');
                    link.href = '#' + titleId[i];
                    link.innerHTML = !isDirNum ? contentArr[i] :
                        dirNum.join('.') + ' ' + contentArr[i] ;
                    li.appendChild(link);
                    currentList.appendChild(li);
                }
                directory.appendChild(root);
            };
        createPostDirectory(document.getElementById('post-content'),document.getElementById('directory'), true);
    };
    postDirectoryBuild();
</script>
<script src="prism.js" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/js/prism.js"></script>
<div id="particles"></div>
<script src="particle.js" tppabs="http://www.oyjie.cn/templates/themes/theme_iiice/static/js/particle.js"></script>
